<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NonoSecret | Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„Ø© ğŸš€</title>
    <style>
        :root { --primary: #ff4d4d; --accent: #00d2ff; --bg: #000000; }
        body { background: var(--bg); color: #fff; font-family: 'Segoe UI', sans-serif; margin: 0; padding-bottom: 100px; }
        .hidden { display: none !important; }
        .card { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 15px; padding: 18px; margin: 15px; position: relative; }
        
        input, textarea { width: 100%; padding: 12px; background: #111; border: 1px solid #333; border-radius: 10px; color: #fff; margin-bottom: 10px; box-sizing: border-box; }
        .btn { background: linear-gradient(135deg, var(--primary), var(--accent)); color: #fff; border: none; padding: 12px; border-radius: 10px; width: 100%; font-weight: bold; cursor: pointer; }
        
        /* Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„ */
        .nav-bar { position: fixed; bottom: 0; left: 0; right: 0; background: #0a0a0a; border-top: 2px solid var(--primary); display: flex; justify-content: space-around; padding: 12px 0; z-index: 9999; }
        .nav-item { color: #555; text-align: center; cursor: pointer; flex: 1; font-size: 11px; }
        .nav-item.active { color: var(--primary); font-weight: bold; }
        .nav-item svg { width: 22px; height: 22px; fill: currentColor; display: block; margin: 0 auto 4px; }

        /* Ø§Ù„Ø±ÙŠØ£ÙƒØªØ§Øª Ø§Ù„Ø£Ø±Ø¨Ø¹Ø© */
        .reacts-row { display: flex; gap: 8px; margin-top: 15px; padding-top: 10px; border-top: 1px solid rgba(255,255,255,0.05); }
        .r-btn { cursor: pointer; padding: 5px 8px; border-radius: 10px; background: rgba(255,255,255,0.03); font-size: 14px; display: flex; align-items: center; gap: 4px; border: 1px solid transparent; }
        .r-btn.active { border-color: var(--accent); background: rgba(0, 210, 255, 0.1); }
        .r-count { font-size: 11px; color: #888; }

        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ‚ */
        .com-area { display: flex; gap: 8px; margin-top: 12px; background: #151515; padding: 6px; border-radius: 12px; border: 1px solid var(--accent); }
        .com-in { flex: 1; background: none !important; border: none !important; margin: 0 !important; padding: 5px !important; color: white; }
        .com-btn { background: var(--primary); border: none; color: white; padding: 5px 12px; border-radius: 8px; cursor: pointer; font-size: 12px; }

        /* ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ */
        .tabs { display: flex; justify-content: center; gap: 20px; margin-bottom: 15px; border-bottom: 1px solid #222; padding-bottom: 10px; }
        .tab-item { cursor: pointer; color: #666; font-size: 14px; }
        .tab-item.active { color: var(--accent); border-bottom: 2px solid var(--accent); }
    </style>
</head>
<body>

    <div id="auth-box">
        <div id="log-in" class="card">
            <h2 style="text-align: center; color: var(--primary);">NonoSecret</h2>
            <input type="text" id="user" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
            <input type="password" id="pass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
            <button class="btn" onclick="login()">Ø¯Ø®ÙˆÙ„ Ø¢Ù…Ù† ğŸ”’</button>
            <p style="text-align: center; font-size: 12px; margin-top: 15px;" onclick="toggleAuth(true)">Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ <span style="color: var(--accent); cursor:pointer">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</span></p>
        </div>
        <div id="sign-up" class="card hidden">
            <h2 style="text-align: center; color: var(--accent);">NonoSecret</h2>
            <input type="text" id="s-user" placeholder="Ø§Ø®ØªØ§Ø±ÙŠ Ø§Ø³Ù… Ù…Ø³ØªØ®Ø¯Ù…">
            <input type="password" id="s-pass" placeholder="Ø§Ø®ØªØ§Ø±ÙŠ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ±">
            <button class="btn" onclick="signup()">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯ âœ¨</button>
            <p style="text-align: center; font-size: 12px; margin-top: 15px;" onclick="toggleAuth(false)">Ø¹Ù†Ø¯Ùƒ Ø­Ø³Ø§Ø¨ØŸ <span style="color: var(--primary); cursor:pointer">Ø¯Ø®ÙˆÙ„</span></p>
        </div>
    </div>

    <div id="app" class="hidden">
        <div id="p-home" class="page">
            <div class="card">
                <textarea id="p-txt" rows="3" placeholder="Ø§ÙƒØªØ¨ÙŠ Ù…Ø§ ÙÙŠ Ù‚Ù„Ø¨Ùƒ ÙŠØ§ Ù†ÙˆØ±.."></textarea>
                <div style="display: flex; gap: 15px; margin-bottom: 10px; font-size: 12px;">
                    <label><input type="checkbox" id="c-bin"> ØªØ´ÙÙŠØ± Binary ğŸ”¢</label>
                    <label><input type="checkbox" id="c-anon"> Ù…Ø¬Ù‡ÙˆÙ„ Ø§Ù„Ù‡ÙˆÙŠØ© ğŸ‘¤</label>
                </div>
                <button class="btn" onclick="createPost()">Ù†Ø´Ø± ÙÙŠ Ø§Ù„Ø¹Ø§Ù… âœ…</button>
            </div>
            <div id="feed"></div>
        </div>

        <div id="p-inbox" class="page hidden">
            <div class="card" style="text-align: center;">
                <h3 style="color: var(--accent);">ØµÙ†Ø¯ÙˆÙ‚ ØµØ±Ø§Ø­Ø© ğŸ“¥</h3>
                <button class="btn" style="margin-bottom:10px" onclick="copyMyLink()">Ù†Ø³Ø® Ø±Ø§Ø¨Ø· ØµØ±Ø§Ø­Ø© Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ ğŸ”—</button>
                <div class="tabs">
                    <span class="tab-item active" id="t-all" onclick="switchInbox('all')">Ø§Ù„ÙˆØ§Ø±Ø¯</span>
                    <span class="tab-item" id="t-fav" onclick="switchInbox('fav')">Ø§Ù„Ù…ÙØ¶Ù„Ø© â­</span>
                </div>
            </div>
            <div id="inbox-list"></div>
        </div>
    </div>

    <nav id="navbar" class="nav-bar hidden">
        <div class="nav-item active" id="nav-h" onclick="tab('home')">
            <svg viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
        </div>
        <div class="nav-item" id="nav-i" onclick="tab('inbox')">
            <svg viewBox="0 0 24 24"><path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/></svg>ØµØ±Ø§Ø­Ø©
        </div>
        <div class="nav-item" onclick="location.reload()">
            <svg viewBox="0 0 24 24"><path d="M13 3h-2v10h2V3zm4.83 2.17l-1.42 1.42C17.99 7.86 19 9.81 19 12c0 3.87-3.13 7-7 7s-7-3.13-7-7c0-2.19 1.01-4.14 2.58-5.42L6.17 5.17C4.23 6.82 3 9.26 3 12c0 4.97 4.03 9 9 9s9-4.03 9-9c0-2.74-1.23-5.18-3.17-6.83z"/></svg>Ø®Ø±ÙˆØ¬
        </div>
    </nav>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getFirestore, collection, addDoc, query, where, orderBy, onSnapshot, serverTimestamp, setDoc, doc, getDoc, updateDoc, deleteField, arrayUnion } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

        const firebaseConfig = { apiKey: "AIzaSyDFMW0n9SVHgsBKZErzgJomFzqmLXAwCdI", authDomain: "nonosecretchat.firebaseapp.com", projectId: "nonosecretchat", storageBucket: "nonosecretchat.firebasestorage.app", messagingSenderId: "829736694500", appId: "1:829736694500:web:56e9fcdd2458b9c81e72f1" };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        let me = "";
        let currentInboxTab = "all";

        window.toggleAuth = (s) => { document.getElementById('log-in').classList.toggle('hidden', s); document.getElementById('sign-up').classList.toggle('hidden', !s); };

        window.signup = async () => {
            const u = document.getElementById('s-user').value.trim(), p = document.getElementById('s-pass').value;
            if(!u || !p) return;
            const ref = doc(db, "users", u);
            const snap = await getDoc(ref);
            if(snap.exists()) return alert("Ø§Ù„Ø§Ø³Ù… Ù…Ø­Ø¬ÙˆØ²!");
            await setDoc(ref, { password: p });
            alert("ØªÙ…! Ø³Ø¬Ù„ÙŠ Ø¯Ø®ÙˆÙ„Ùƒ."); toggleAuth(false);
        };

        window.login = async () => {
            const u = document.getElementById('user').value.trim(), p = document.getElementById('pass').value;
            const snap = await getDoc(doc(db, "users", u));
            if(snap.exists() && snap.data().password === p) {
                me = u; document.getElementById('auth-box').classList.add('hidden');
                document.getElementById('app').classList.remove('hidden');
                document.getElementById('navbar').classList.remove('hidden');
                loadFeed(); loadInbox();
            } else alert("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª!");
        };

        window.tab = (p) => {
            document.querySelectorAll('.page').forEach(pg => pg.classList.add('hidden'));
            document.getElementById('p-' + p).classList.remove('hidden');
            document.querySelectorAll('.nav-item').forEach(ni => ni.classList.remove('active'));
            document.getElementById('nav-' + p.charAt(0)).classList.add('active');
        };

        // Ø§Ù„Ù†Ø´Ø± Ù…Ø¹ Ø§Ù„ØªØ´ÙÙŠØ± ÙˆØ§Ù„Ù…Ø¬Ù‡ÙˆÙ„
        window.createPost = async () => {
            const t = document.getElementById('p-txt').value, bin = document.getElementById('c-bin').checked, anon = document.getElementById('c-anon').checked;
            if(!t.trim()) return;
            let val = t;
            if(bin) val = val.split('').map(c => c.charCodeAt(0).toString(2).padStart(8,'0')).join(' ');
            await addDoc(collection(db, "posts"), { u: anon ? "Ù…Ø¬Ù‡ÙˆÙ„" : me, t: val, re: {}, co: [], time: serverTimestamp() });
            document.getElementById('p-txt').value = "";
        };

        function loadFeed() {
            onSnapshot(query(collection(db, "posts"), orderBy("time", "desc")), (snap) => {
                const f = document.getElementById('feed'); f.innerHTML = "";
                snap.forEach(d => {
                    const p = d.data(), rs = p.re || {}, myR = rs[me] || null;
                    const counts = { 'â¤ï¸':0, 'ğŸ˜‚':0, 'ğŸ˜®':0, 'ğŸ˜¢':0 };
                    Object.values(rs).forEach(v => { if(counts[v]!==undefined) counts[v]++; });

                    f.innerHTML += `
                        <div class="card">
                            <small style="color:var(--accent)">@${p.u}</small><p>${p.t}</p>
                            <div class="reacts-row">
                                ${['â¤ï¸','ğŸ˜‚','ğŸ˜®','ğŸ˜¢'].map(e => `
                                    <div class="r-btn ${myR===e?'active':''}" onclick="doRe('${d.id}','${e}','${myR}')">
                                        ${e} <span class="r-count">${counts[e]}</span>
                                    </div>
                                `).join('')}
                            </div>
                            <div class="com-area">
                                <input type="text" id="in-${d.id}" class="com-in" placeholder="ØªØ¹Ù„ÙŠÙ‚..">
                                <button class="com-btn" onclick="addCo('${d.id}')">Ø¥Ø±Ø³Ø§Ù„</button>
                            </div>
                            <div style="font-size:11px; margin-top:10px; color:#aaa;">${(p.co || []).map(c => `<div><b>${c.u}:</b> ${c.t}</div>`).join('')}</div>
                        </div>`;
                });
            });
        }

        window.doRe = async (id, e, cur) => { await updateDoc(doc(db, "posts", id), { [`re.${me}`]: cur === e ? deleteField() : e }); };
        window.addCo = async (id) => {
            const el = document.getElementById(`in-${id}`); if(!el.value.trim()) return;
            await updateDoc(doc(db, "posts", id), { co: arrayUnion({ u: me, t: el.value }) }); el.value = "";
        };

        // Ù†Ø¸Ø§Ù… ØµØ±Ø§Ø­Ø© Ø§Ù„Ù…Ø·ÙˆØ± (ÙˆØ§Ø±Ø¯ + Ù…ÙØ¶Ù„Ø©)
        window.switchInbox = (t) => {
            currentInboxTab = t;
            document.querySelectorAll('.tab-item').forEach(i => i.classList.remove('active'));
            document.getElementById('t-' + t).classList.add('active');
            loadInbox();
        };

        window.toggleFav = async (id, curFav) => {
            await updateDoc(doc(db, "sarahah", id), { fav: !curFav });
        };

        function loadInbox() {
            let q = query(collection(db, "sarahah"), where("to", "==", me), orderBy("time", "desc"));
            if(currentInboxTab === "fav") q = query(collection(db, "sarahah"), where("to", "==", me), where("fav", "==", true));

            onSnapshot(q, (snap) => {
                const list = document.getElementById('inbox-list'); list.innerHTML = "";
                snap.forEach(d => {
                    const m = d.data();
                    list.innerHTML += `
                        <div class="card">
                            <p>${m.text}</p>
                            <div style="text-align:left; font-size:18px; cursor:pointer;" onclick="toggleFav('${d.id}', ${m.fav || false})">
                                ${m.fav ? 'â­' : 'â˜†'}
                            </div>
                        </div>`;
                });
            });
        }

        window.copyMyLink = () => {
            const link = window.location.origin + window.location.pathname + "?user=" + me;
            navigator.clipboard.writeText(link); alert("ØªÙ… Ù†Ø³Ø® Ø±Ø§Ø¨Ø· ØµØ±Ø§Ø­Ø© Ø¨Ù†Ø¬Ø§Ø­ âœ…");
        };

        // Ø§Ø³ØªÙ„Ø§Ù… Ø±Ø³Ø§Ø¦Ù„ ØµØ±Ø§Ø­Ø© Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø·
        const urlParams = new URLSearchParams(window.location.search);
        const toUser = urlParams.get('user');
        if(toUser) {
            const msg = prompt("Ø§ÙƒØªØ¨ÙŠ Ø±Ø³Ø§Ù„Ø© ØµØ±Ø§Ø­Ø© Ù„Ù€ " + toUser);
            if(msg) {
                addDoc(collection(db, "sarahah"), { to: toUser, text: msg, fav: false, time: serverTimestamp() })
                .then(() => { alert("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„ØªÙƒ Ø¨Ù†Ø¬Ø§Ø­!"); window.location.href = window.location.origin + window.location.pathname; });
            }
        }
    </script>
</body>
</html>